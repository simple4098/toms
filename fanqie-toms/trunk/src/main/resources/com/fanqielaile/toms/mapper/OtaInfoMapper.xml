<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.fanqielaile.toms.dao.IOtaInfoDao" >
      <!-- <resultMap id="BaseResultMap" type="com.fanqielaile.toms.model.OtaInfo">
              <id column="id" property="id" />
              <result column="ota_info" property="otaInfo"/>
              <result column="ota_type" property="otaType"/>
              <result column="appkey" property="appKey"/>
              <result column="appsecret" property="appSecret"/>
              <result column="sessionkey" property="sessionKey"/>
              <result column="company_id" property="companyId"/>
              <result column="deleted" property="deleted"/>
       </resultMap>

       <resultMap id="otaInfoDtoId" type="com.fanqielaile.toms.dto.OtaInfoDto" extends="BaseResultMap">
           <result column="company_code" property="companyCode"/>
       </resultMap>-->
        <resultMap id="otaInfoRefId" type="com.fanqielaile.toms.dto.OtaInfoRefDto">
            <result column="id" property="id" />
            <result column="ota_id" property="otaId" />
            <result column="ota_info_id" property="otaInfoId" />
            <result column="ota_info" property="otaInfo"/>
            <result column="ota_type" property="otaType"/>
            <result column="appkey" property="appKey"/>
            <result column="appsecret" property="appSecret"/>
            <result column="sessionkey" property="sessionKey"/>
            <result column="company_id" property="companyId"/>
            <result column="company_code" property="companyCode"/>
            <result column="sort" property="sort"/>
        </resultMap>

       <select id="selectAllOtaByCompany" parameterType="java.lang.String" resultMap="otaInfoRefId">
           /*   SELECT o.* from ota_info o left JOIN  company c on c.id = o.company_id
              where o.deleted = 0 and c.company_code = '${companyCode}'*/
          SELECT oi.ota_info,oi.ota_type ,oi.sort,o.* from ota_info oi
          LEFT  JOIN otainfo_company_ref o ON oi.id = o.ota_info_id
          left JOIN  company c on c.id = o.company_id
          where oi.deleted=0 and c.company_code = '${companyCode}' ORDER BY oi.sort
       </select>

       <select id="selectAllOtaByCompanyAndType"  resultMap="otaInfoRefId">
          SELECT oi.ota_info,oi.ota_type ,oi.sort,o.* from ota_info oi
          LEFT  JOIN otainfo_company_ref o ON oi.id = o.ota_info_id
          where oi.deleted=0 and o.company_id='${companyId}' and oi.ota_type = '${otaType}' limit 1
       </select>

       <select id="selectOtaInfoList" resultMap="otaInfoRefId" >
          SELECT oi.ota_info,oi.ota_type ,oi.sort,c.company_code,o.* from ota_info oi
          LEFT  JOIN otainfo_company_ref o ON oi.id = o.ota_info_id
          left JOIN  company c on c.id = o.company_id
          where oi.deleted=0
       </select>

       <select id="selectOtaInfoListByCompanyId" parameterType="java.lang.String" resultMap="otaInfoRefId">
          SELECT oi.ota_info,oi.ota_type ,oi.sort,o.* from ota_info oi
          LEFT  JOIN otainfo_company_ref o ON oi.id = o.ota_info_id
          where oi.deleted=0  and  o.company_id='${companyId}' ORDER BY oi.sort
       </select>

    <insert id="saveOtaInfo" parameterType="com.fanqielaile.toms.dto.OtaInfoRefDto">
        insert into otainfo_company_ref(id,ota_info_id,company_id,appkey,appsecret,sessionkey,status)
              values (#{uuid},#{otaId},#{companyId},#{appKey},#{appSecret},#{sessionKey},1)
    </insert>

    <select id="findOtaInfoByOtaIdAndCompanyId" parameterType="com.fanqielaile.toms.dto.OtaInfoRefDto" resultMap="otaInfoRefId">
         SELECT oi.ota_info,oi.ota_type ,oi.sort,o.* from ota_info oi
          LEFT  JOIN otainfo_company_ref o ON oi.id = o.ota_info_id and o.company_id='${companyId}'
          where o.ota_info_id = '${otaId}'
    </select>

</mapper>